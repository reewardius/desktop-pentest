$exePath = "C:\Program Files\Oracle\VirtualBox\VirtualBox.exe"

$process = Start-Process -FilePath $exePath -PassThru

$childProcesses = Get-WmiObject Win32_Process | Where-Object { $_.ParentProcessId -eq $process.Id }

$notFoundDLLs = @()

foreach ($childProcess in $childProcesses) {
    $loadedDLLs = Get-Process -Id $childProcess.ProcessId | Select-Object -ExpandProperty Modules

    $notFoundDLLs += $loadedDLLs | Where-Object { $_.ModuleName -eq "NAME NOT FOUND" } | Select-Object -ExpandProperty FileName
}

$uniqueNotFoundDLLs = $notFoundDLLs | Select-Object -Unique

if ($uniqueNotFoundDLLs) {
    Write-Host "DLL, которые не были найдены и могут быть уязвимы к DLL Hijacking:"
    foreach ($dll in $uniqueNotFoundDLLs) {
        Write-Host $dll
    }
} else {
    Write-Host "All DLLs were successfully loaded."
}
