# Укажите путь к exe-файлу, который вы хотите запустить
$exePath = "C:\Program Files\Oracle\VirtualBox\VirtualBox.exe"

# Запускаем процесс
$process = Start-Process -FilePath $exePath -PassThru

# Получаем все дочерние процессы запущенного процесса
$childProcesses = Get-WmiObject Win32_Process | Where-Object { $_.ParentProcessId -eq $process.Id }

# Создаем массив для хранения имен файлов DLL, которые не были найдены
$notFoundDLLs = @()

# Проходим по каждому дочернему процессу
foreach ($childProcess in $childProcesses) {
    # Получаем список всех DLL, загруженных процессом
    $loadedDLLs = Get-Process -Id $childProcess.ProcessId | Select-Object -ExpandProperty Modules

    # Фильтруем DLL с состоянием "NAME NOT FOUND"
    $notFoundDLLs += $loadedDLLs | Where-Object { $_.ModuleName -eq "NAME NOT FOUND" } | Select-Object -ExpandProperty FileName
}

# Удаляем дубликаты из массива DLL
$uniqueNotFoundDLLs = $notFoundDLLs | Select-Object -Unique

# Выводим список DLL, которые не были найдены
if ($uniqueNotFoundDLLs) {
    Write-Host "DLL, которые не были найдены и могут быть уязвимы к DLL Hijacking:"
    foreach ($dll in $uniqueNotFoundDLLs) {
        Write-Host $dll
    }
} else {
    Write-Host "All DLLs were successfully loaded."
}
